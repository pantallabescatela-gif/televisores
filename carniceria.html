<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Other page</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    
    <link rel="stylesheet" href="styles.css" />

    <script type="module" src="script.js"></script>
  </head>
  <body onload="cargarData()">
     
    <main id="carniceria"> 
      <div class="header" >
        <h1 class="titulos" style="color:white">GALERIA HYPERMARKET</h1>
        <div class="titulos"  style="color:white">carniceria</div>
      </div>
     <div class="listas">
      
      <div class="listaProductos">
        

      </div>


    </div>
      
     
      
    </main>
  </body>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script>
  var contador=4;
  var tasadelDia=0;
  const timeline = gsap.timeline({
    duration: 1,
    paused: false
});
function loadAnimation() {
  timeline.to(".listaProductos .producto", {
    duration: 3,
    opacity: 1,
    stagger: 0.3
  });
  timeline.play();
}

function updatetime() {
  const now = new Date();
  const today = new Date();      
        let hours = now.getHours();
        let minutes = now.getMinutes();
        let seconds = now.getSeconds();

        const day = String(today.getDate()).padStart(2, '0');
        const month = String(today.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed, so add 1
        const year = today.getFullYear();
       
        hours = hours < 10 ? '0' + hours : hours;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        seconds = seconds < 10 ? '0' + seconds : seconds;

        // Format the time as HH:MM:SS
        const timeString = day+ '/' + month + '/' + year+" "+hours + ':' + minutes + ':' + seconds ;

        // Update the content of the 'liveClock' div
        document.getElementById('hours').innerHTML = timeString;
}

function transformacionPrecio(tasa, precio) {

  return (Number(tasa)*Number(precio)).toFixed(2)
}

 function cargarData(){
  updatetime();
  fetch('./lib/tasa.json').then(function(response) {
    if (response.ok) {
      response.json().then(function (response) {
        tasadelDia=response.data.tasa;
        document.querySelector(".segundaSection").innerHTML=tasadelDia;
      })

  fetch('./lib/carniceria.json').then(function(response) {
  let text="";
  
  if(response.ok) {
    response.json().then(function(response) {
      
      let data=response.data.carniceria.slice(0,20);
       
      for (const productos of data) {
        
        let text2=`<div class='producto'>
          <div class='nombreProducto'>${productos.descripcion} <div class='precioProducto'>Bs.S ${transformacionPrecio(tasadelDia,productos.precio)}</div> </div>
          </div>
          `
        text+=text2;
      }
      document.querySelector(".listaProductos").innerHTML=text;
      loadAnimation()
    });
  } else {
    console.log('Respuesta de red OK pero respuesta HTTP no OK');
  }
})
.catch(function(error) {
  console.log('Hubo un problema con la petición Fetch:' + error.message);
});
    }
  })


}
 
setInterval(updatetime,1000);

setInterval(function(){
  let text="";

  fetch('./lib/tasa.json').then(function(response) {
    if (response.ok) {
      response.json().then(function (response) {
        tasadelDia=response.data.tasa;
        document.querySelector(".segundaSection").innerHTML=tasadelDia;
      })
    }
  })
 
  fetch('./lib/carniceria.json').then(function(response) {
    if(response.ok) {
      response.json().then(function(response) {
        document.querySelector(".listaProductos").innerHTML="";
        let data=response.data.carniceria.slice(0,contador+20);
         
        for (const productos of data) {
          let text2=`<div class='producto'>
          <div class='nombreProducto'>${productos.descripcion} <div class='precioProducto'>Bs.S ${transformacionPrecio(tasadelDia,productos.precio)}</div> </div>
          </div>
          `
          text+=text2;
        }
        document.querySelector(".listaProductos").innerHTML=text;
        loadAnimation()
        if(contador>=response.data.carniceria.length-5){
          contador=0;
          }else{
          contador=contador+4;
          }
      });
    } else {
      console.log('Respuesta de red OK pero respuesta HTTP no OK');
    }
  })
  .catch(function(error) {
    console.log('Hubo un problema con la petición Fetch:' + error.message);
  });
}
  , 60000);

   </script>
</html>
